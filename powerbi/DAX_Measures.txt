// DAX Measures for Sales Analytics Dashboard
// Copy and paste these into Power BI Desktop

// === BASIC METRICS ===

Total Revenue = SUM(sales[total_sales])

Total Quantity = SUM(sales[quantity])

Average Order Value = DIVIDE([Total Revenue], [Total Quantity], 0)

Total Transactions = COUNTROWS(sales)

Average Unit Price = AVERAGE(sales[unit_price])

// === TIME INTELLIGENCE ===

Revenue Previous Year = 
CALCULATE(
    [Total Revenue],
    SAMEPERIODLASTYEAR('sales'[date])
)

Revenue Growth YoY = 
DIVIDE([Total Revenue] - [Revenue Previous Year], [Revenue Previous Year], 0)

Revenue Growth YoY % = 
FORMAT([Revenue Growth YoY], "0.0%")

Monthly Revenue = 
CALCULATE(
    [Total Revenue],
    DATESMTD('sales'[date])
)

// === PRODUCT ANALYTICS ===

Top Product by Revenue = 
VAR TopProductRevenue = 
    MAXX(
        SUMMARIZE(sales, sales[product], "ProductRevenue", [Total Revenue]),
        [ProductRevenue]
    )
RETURN
    CALCULATE(
        SELECTEDVALUE(sales[product]),
        [Total Revenue] = TopProductRevenue
    )

Product Rank by Revenue = 
RANKX(
    ALLSELECTED(sales[product]),
    [Total Revenue],
    ,
    DESC
)

// === REGIONAL ANALYTICS ===

Regional Market Share = 
DIVIDE(
    [Total Revenue],
    CALCULATE([Total Revenue], ALLSELECTED(sales[region]))
)

Top Region = 
VAR TopRegionRevenue = 
    MAXX(
        SUMMARIZE(sales, sales[region], "RegionRevenue", [Total Revenue]),
        [RegionRevenue]
    )
RETURN
    CALCULATE(
        SELECTEDVALUE(sales[region]),
        [Total Revenue] = TopRegionRevenue
    )

// === PERFORMANCE INDICATORS ===

Revenue vs Target = 
VAR Target = 130000000  // $130M annual target
RETURN
DIVIDE([Total Revenue], Target, 0)

Performance Status = 
IF(
    [Revenue vs Target] >= 1, "✅ Above Target",
    IF([Revenue vs Target] >= 0.9, "⚠️ Close to Target", "❌ Below Target")
)

// === ADVANCED CALCULATIONS ===

Revenue Contribution % = 
DIVIDE(
    [Total Revenue],
    CALCULATE([Total Revenue], REMOVEFILTERS())
)

Running Total Revenue = 
CALCULATE(
    [Total Revenue],
    FILTER(
        ALLSELECTED(sales),
        sales[date] <= MAX(sales[date])
    )
)

Average Monthly Revenue = 
VAR MonthCount = DISTINCTCOUNT(sales[month])
RETURN
DIVIDE([Total Revenue], MonthCount, 0)

// === CONDITIONAL FORMATTING ===

Revenue Color = 
SWITCH(
    TRUE(),
    [Total Revenue] > 50000000, "#2E7D32",  // Dark Green
    [Total Revenue] > 25000000, "#FFA000",  // Orange  
    "#D32F2F"  // Red
)

// === TEXT MEASURES FOR CARDS ===

Total Revenue Text = 
"$" & FORMAT([Total Revenue]/1000000, "#,##0.0") & "M"

Total Quantity Text = 
FORMAT([Total Quantity], "#,##0")

AOV Text = 
"$" & FORMAT([Average Order Value], "#,##0")

Growth Text = 
IF([Revenue Growth YoY] > 0, 
   "↗️ " & FORMAT([Revenue Growth YoY], "+0.0%"),
   "↘️ " & FORMAT([Revenue Growth YoY], "0.0%")
)
